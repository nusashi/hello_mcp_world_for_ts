# hello_world 学習者向けQ&A

## 基本概念

### Q: MCPとは何ですか？
A: Model Context Protocol（MCP）は、大規模言語モデル（LLM）アプリケーションにコンテキスト情報を提供するための標準化されたプロトコルです。LLMがより多くの情報にアクセスし、より適切な応答を生成できるようにします。

### Q: リソースとツールの違いは何ですか？
A: リソースはデータを表し、ツールは機能を表します。リソースはクライアントが読み込むもので、情報やコンテンツを提供します。ツールはクライアントが呼び出すもので、何らかの処理や計算を行います。簡単に言えば、リソースはGETリクエスト、ツールはPOSTリクエストに似ています。

### Q: トランスポートとは何ですか？
A: トランスポートは、クライアントとサーバー間の通信方法を定義します。MCPはさまざまなトランスポート方式をサポートしています：
- Stdio: 標準入出力を使用（コマンドラインツールなど）
- HTTP/SSE: HTTPを使用（Webアプリケーションなど）
- WebSocket: 双方向通信（リアルタイムアプリケーションなど）

### Q: JSON-RPCとは何ですか？
A: JSON-RPCは、JSONを使用したリモートプロシージャコール（RPC）のための軽量なプロトコルです。MCPはJSON-RPCを使用してクライアントとサーバー間の通信を行います。リクエスト、レスポンス、エラーなどの形式が定義されています。

## 環境設定

### Q: プロジェクトの実行に必要な環境は？
A: Node.js（v18以降推奨）とnpmが必要です。TypeScriptを理解するための基本的な知識も役立ちます。

### Q: `npm run start:server`と`npm run start:client`の違いは？
A: `start:server`はMCPサーバーを起動します。`start:client`はMCPクライアントを起動し、サーバーに接続して通信を行います。クライアントはサーバーが起動していることを前提としています。

### Q: パッケージのインストールでエラーが発生する場合は？
A: 次のことを確認してください：
1. Node.jsとnpmが正しくインストールされているか
2. インターネット接続が正常か
3. npm registryにアクセスできるか
4. package.jsonが正しいか

### Q: Windowsでchmodエラーが出る場合はどうすればいいですか？
A: Windowsでは`chmod`コマンドがサポートされていないため、package.jsonのscriptsセクションから`chmod`を含むコマンドを削除してください。代わりに`"build": "tsc"`のように単純な形式を使用します。

## SDK関連

### Q: ServerとMcpServerの違いは何ですか？
A: `Server`は低レベルのAPIを提供するMCPサーバークラスで、`McpServer`はそのラッパーとして動作する高レベルのAPIです。`McpServer`は内部で`Server`インスタンスを作成し、`server`プロパティとして公開しています。基本的な使用では`McpServer`を使用するほうが簡単です。

### Q: SDKのバージョンによる違いはありますか？
A: はい、バージョンによってAPIの構造や要件が異なる場合があります。例えば：
- 1.0.1では`Server`クラスが直接使われていましたが、1.6.1では`McpServer`が推奨されています
- インポートパスの構造も変わっています
- capabilitiesの要件も変わっている可能性があります

### Q: 正しいインポートパスはどのように指定すべきですか？
A: SDKのバージョン1.6.1での正しいインポートパスは以下の通りです：
```typescript
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
```
拡張子`.js`を含めることが重要です。

### Q: capabilitiesとは何ですか？また、どのように設定すべきですか？
A: capabilitiesはサーバーがサポートする機能を定義します。最小限のサーバーでも、`resources`と`tools`の両方を含める必要があります：
```typescript
const server = new McpServer(
    { name: "my-server", version: "1.0.0" },
    {
        capabilities: {
            resources: {}, // 必須
            tools: {},     // 必須
        }
    }
);
```

## 実装関連

### Q: リソースマネージャーがSDKのURIテンプレート機能の代わりに使われる理由は？
A: SDKのURIテンプレート機能は完全ではない場合があり、特に複雑なパラメータや日本語などの非ASCII文字を含むパラメータの処理に問題がある可能性があります。リソースマネージャーはこの問題を回避し、より柔軟なリソース管理を提供します。

### Q: Zodスキーマを使用する理由は？
A: Zodはランタイムでのデータバリデーションを提供するライブラリです。TypeScriptの型定義だけでは実行時の検証はできませんが、Zodを使うことで型安全性とランタイムバリデーションの両方を実現できます。

### Q: サーバーとクライアントのcapabilitiesとは？
A: capabilitiesは、サーバーやクライアントがサポートする機能を表します。初期化時に交換され、互いに何ができるかを知るために使用されます。このプロジェクトでは、resourcesとtoolsの基本的な機能をサポートしています。

### Q: `console.error`がログに使われている理由は？
A: Node.jsでは、`console.log`は標準出力（stdout）に、`console.error`は標準エラー出力（stderr）に出力されます。MCPサーバーでは標準出力がクライアントとの通信に使用されるため、ログは標準エラー出力に送る必要があります。

## エラー対応

### Q: TypeScriptのモジュール解決エラーが発生した場合は？
A: 以下の対策を試してください：
1. インポートパスに`.js`拡張子を含める
2. tsconfig.jsonの`moduleResolution`を`NodeNext`に設定
3. 必要に応じて`skipLibCheck: true`を追加
4. package.jsonの`type`フィールドを`module`に設定

### Q: 「Connection refused」エラーが発生する場合は？
A: サーバーが起動していない、または別のポートで実行されている可能性があります。HTTPサーバーの場合は、指定されたポート（デフォルトは3000）が他のアプリケーションに使用されていないか確認してください。

### Q: 「Method not found」エラーが発生する場合は？
A: 呼び出そうとしているメソッド（リソースやツール）がサーバーに登録されていない、または名前が間違っている可能性があります。サーバーのログを確認し、正しいメソッド名を使用しているか確認してください。

### Q: 日本語リソースにアクセスできない場合は？
A: URIに日本語が含まれる場合、正しくURLエンコードされていることを確認してください。例えば、「山田太郎」は「%E5%B1%B1%E7%94%B0%E5%A4%AA%E9%83%8E」のようにエンコードされる必要があります。クライアントコードでは`encodeURIComponent()`を使用しています。

### Q: TypeScriptのコンパイルエラーが発生する場合は？
A: 次のことを確認してください：
1. すべての型が正しく定義されているか
2. 必要なimport文があるか
3. tsconfig.jsonの設定が正しいか
4. 特にnullやundefinedの可能性がある値を扱う場合、型チェックが厳密になっていないか

## GitHub/NPXとの連携

※ リモートでの公開を検討されている場合は、別途、パッケージの公開方法についてお調べいただくことをお勧めします。

### Q: GitHubリポジトリからnpxで実行するには何が必要ですか？
A: GitHubリポジトリからnpxでMCPサーバーを実行するには、適切なpackage.jsonとTypeScriptの設定が必要です。リポジトリがパブリックであること、依存関係が正しく設定されていることを確認してください。

### Q: npxコマンドを使ったMCPサーバーの実行例は？
A: ビルド済みのパッケージをnpmレジストリに公開して、そこから実行する方法があります：

```json
{
  "mcpServers": {
    "hello_world": {
      "command": "npx",
      "args": [
        "-y",
        "your-package-name"
      ]
    }
  }
}
```

他の方法としては、MCPサーバーをnpxで実行する方法がいくつかあります。最も柔軟な方法の一つは、ts-nodeを使用してTypeScriptファイルを直接実行する方法です：

```json
{
  "mcpServers": {
    "hello_world": {
      "command": "npx",
      "args": [
        "-y",
        "ts-node",
        "--esm",
        "https://raw.githubusercontent.com/username/repo/main/index.ts"
      ]
    }
  }
}
```

この方法では、次の点に注意が必要です：
1. TypeScriptファイルがESモジュール形式で記述されている必要がある
2. `--esm` フラグを指定してts-nodeがESモジュールをサポートするようにする
3. インポートパスは完全修飾パス（`@modelcontextprotocol/sdk/dist/esm/...`）を使用するとより確実
4. 初回実行時にts-nodeと依存関係をダウンロードするため、時間がかかることがある


### Q: ローカルのnpmパッケージからMCPサーバーを実行する方法は？
A: プロジェクトをビルドしてから、以下のようにJSON設定を作成します：
```json
{
  "mcpServers": {
    "hello_world": {
      "command": "node",
      "args": [
        "/absolute/path/to/dist/index.js"
      ]
    }
  }
}
```

## 拡張と応用

### Q: プロジェクトをどのように拡張できますか？
A: 以下の方向での拡張が考えられます：
1. より複雑なリソース型（JSON、バイナリデータなど）の追加
2. データベースや外部APIと連携するリソースやツールの実装
3. 認証・認可機能の追加
4. WebSocketトランスポートの実装
5. Webインターフェースの作成

### Q: 実際のLLMアプリケーションとどのように統合できますか？
A: LLMアプリケーションはMCPクライアントとして機能し、MCPサーバーからリソースを読み込んだりツールを呼び出したりすることができます。具体的には：
1. LLMのプラグインシステムを使用
2. RAGパイプラインにMCPリソースを組み込む
3. LLMからのツール呼び出し（Function calling）でMCPツールを活用

### Q: 本番環境での運用に必要な追加要素は？
A: 本番環境では以下を検討する必要があります：
1. エラーハンドリングの強化
2. ロギングとモニタリング
3. 認証と認可
4. レート制限
5. キャッシュ戦略
6. スケーラビリティ対策
7. HTTPS/TLSサポート

### Q: パフォーマンスを改善するには？
A: 以下の方法でパフォーマンスを改善できます：
1. リソースのキャッシュ
2. 非同期処理の最適化
3. リソースのバッチ読み込み
4. コネクションプーリング
5. リクエスト/レスポンスの圧縮

## プロジェクト固有

### Q: `MCP_LOG_LEVEL`環境変数の値は何を意味しますか？
A: ログの詳細レベルを制御します：
- 0: DEBUG - すべてのログを表示
- 1: INFO - 情報、警告、エラーを表示
- 2: WARN - 警告とエラーのみ表示
- 3: ERROR - エラーのみ表示
- 4: NONE - ログを表示しない

### Q: ResourceManagerクラスの拡張方法は？
A: 次のように拡張できます：
1. 新しいリソースタイプを処理するメソッドを追加
2. 動的URIテンプレートのサポートを改善
3. リソースのメタデータ管理を追加
4. キャッシュ機能を実装
5. より詳細なエラーレポートを提供

### Q: HTTPサーバー実装はなぜシンプルなのですか？
A: このプロジェクトはMCPの基本概念を学ぶための最小限の実装を目指しています。実際のアプリケーションでは、ExpressなどのWebフレームワークを使用して、より堅牢なHTTPサーバーを実装することをお勧めします。

### Q: このプロジェクトでサポートされていないMCP機能は？
A: 以下の機能はこのシンプルな実装ではカバーされていません：
1. 認証と認可
2. リソース更新通知
3. リソーステンプレートの完全なサポート
4. ストリーミングリソース
5. 複雑なエラーハンドリング
6. プログレス通知
7. リクエストキャンセル

### Q: Stdioトランスポートでサーバーとクライアントはどのように接続しますか？
A: クライアント側で`StdioClientTransport`を作成する際に、サーバープロセスを子プロセスとして起動します。その後、標準入出力（stdio）を通じて通信を行います。具体的には：

```typescript
const transport = new StdioClientTransport({
  command: "node",
  args: ["--loader", "ts-node/esm", "src/index.ts"],
  stderr: 'inherit'
});
```

このコードは、Node.jsコマンドを使用してサーバーを起動し、その標準入出力をクライアントの通信チャネルとして使用します。

### Q: TypeScriptとJavaScriptのどちらを使うべきですか？
A: MCPの実装には型安全性が重要なため、TypeScriptを使用することをお勧めします。TypeScriptを使用することで、以下の利点があります：
1. データ構造の型チェック
2. 開発時のエラー検出
3. IDEによるコード補完とドキュメンテーション
4. リファクタリングの容易さ

ただし、既存のJavaScriptプロジェクトに組み込む場合は、JavaScriptでも実装可能です。その場合、ランタイムバリデーションにより注意を払う必要があります。

### Q: Zodの代わりに他のバリデーションライブラリを使用できますか？
A: はい、Joi、Ajv、yupなど、他のバリデーションライブラリも使用できます。Zodを選択した理由は以下の通りです：
1. TypeScriptとの統合が優れている
2. 型推論が強力
3. APIがシンプルで直感的
4. パフォーマンスが良好

他のライブラリを使用する場合は、TypeScriptの型定義との連携方法を確認してください。

### Q: このプロジェクトは実際のアプリケーションに使用できますか？
A: このプロジェクトは教育目的のサンプル実装です。実際のアプリケーションで使用する場合は、以下の点を考慮して拡張する必要があります：
1. エラーハンドリングの強化
2. セキュリティ対策の追加
3. パフォーマンス最適化
4. スケーラビリティの考慮
5. 完全なAPI実装

基本的な概念は同じですが、実際のアプリケーションではより堅牢な実装が必要です。
